# EthScrapper

## Reqirements
1. `Go`: 

<details>
<summary>
Installtion
</summary>

1. Install Go version 1.16 or above.

2. Define GOPATH environment variable and modify PATH to access your Go binaries. A common setup is as follows. You could always specify it based on your own flavor.

```sh
export GOPATH=$HOME/go
export PATH=$PATH:$GOPATH/bin
```

</details>

2. `Docker`: [Installation](https://docs.docker.com/engine/install/)
3. `API Key`: Visit `Infura` or `Alchemy`

## Key Highlights
> **`func TestDatabase`**<br>
> It is used for testing conncetion with Redis Database via client.

> **`func retrieve`**<br>
> It is used for retrieving all the stored keys and values.

> **`func exportDataToLogFile`**<br>
> It is used to export data stored in RedisDB to a log(`redis.log`) file (at project root)

> **`func fetchBlockWithRetry`**<br>
> There is a chance that the JSON-RPC URL (aka `PROJECT_ID`) being used has certain limit to the number of API requests that can be made at once.<br>
> So to avoid errors like `429 Too Many Requests` I implemented this method. (I implemented a retry logic)

## Demo
> **Payload:**<br>
>   - `contract address` : 0x919Ab642766D1a015F546811F15d5DB324F5E415
>   - `topic hash` : 0x3e54d0825ed78523037d00a81759237eb436ce774bd546993ee67a1b67b6e766

```sh
make start
```

<details>
<summary>
Output (If Rate limit Doesn't exceed)
</summary>

```js
672c0e2889776e5b04846fdbe19edd70fb8cc5cf871e7ff8e41fdb01862b1484
Welcome to EthScrapper for Sepolia
[INFO]		Latest block number: 6529830
2024/08/19 15:38:11 Found <1> keys in Redis
[INFO]		Found <20> logs
[INFO]        	- related to Topic <0x3e54d0825ed78523037d00a81759237eb436ce774bd546993ee67a1b67b6e766>
[INFO]        	- in Contract Address <0x919Ab642766D1a015F546811F15d5DB324F5E415>
2024/08/19 15:38:17 |=================================|
2024/08/19 15:38:17 | All events stored successfully. |
2024/08/19 15:38:17 |=================================|
2024/08/19 15:38:17 Found <21> keys in Redis
2024/08/19 15:38:17 Exported 21 key-value pairs to redis.log
```

</details>

<details>
<summary>
Output (If Rate limit exceeds)
</summary>

```js
839c02ed0867c3d7d55750e12a0141ab8c27db74bbc9ec58c68324c02faa1143
Welcome to EthScrapper for Sepolia
[INFO]		Latest block number: 6529858
2024/08/19 15:43:57 Found <1> keys in Redis
[INFO]		Found <156> logs
[INFO]        	- related to Topic <0x3e54d0825ed78523037d00a81759237eb436ce774bd546993ee67a1b67b6e766>
[INFO]        	- in Contract Address <0x919Ab642766D1a015F546811F15d5DB324F5E415>
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 1s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
[WARN]		Rate limit exceeded, retrying in 2s...
2024/08/19 15:44:29 |=================================|
2024/08/19 15:44:29 | All events stored successfully. |
2024/08/19 15:44:29 |=================================|
2024/08/19 15:44:29 Found <157> keys in Redis
2024/08/19 15:44:29 Exported 157 key-value pairs to redis.log
```

</details>


## Installation

### 1. Setup `.env` file

> Set up a `.env` file in the root of your project directory. Follow `.env.example` to create the `.env` file.

By default, passowrd of RedisDB is `ethscrapper` (use it in `.env` file). You can change it in **`redis.conf`** (`./conf/redis.conf`) 

### 2. Build the project

> There is a `Makefile` in the project directory, you can have a look at it to get a detailed overview of all the commands.

**Build**
```sh
make build
```

**Start** (build + launch docker image + run script) - Prefered to use One time
```sh
make start
```

**Run** (build + run script) - Can use is multiple times after `make start`
```sh
make run
```

**Stop** (Kills redis image) - Once work is done, stop everything
```sh
make stop
```
